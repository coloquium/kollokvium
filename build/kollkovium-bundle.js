!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.TextMessage=class{constructor(e,t,n,r){this.D=t,this.T=e,this.C=n,this.B=r}get JSON(){return{T:this.T,D:JSON.stringify(this.D),C:this.C}}toString(){return JSON.stringify(this.JSON)}static fromArrayBuffer(e){return r.BinaryMessage.fromArrayBuffer(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),i=n(0);t.BinaryMessage=class{constructor(e,t){this.arrayBuffer=t,this.header=new Uint8Array(r.Utils.longToArray(e.length)),this.Buffer=this.joinBuffers(this.joinBuffers(this.header.buffer,r.Utils.stingToBuffer(e).buffer),t)}static fromArrayBuffer(e){let t=new Uint8Array(e),n=t.slice(0,8),o=r.Utils.arrayToLong(n),s=n.byteLength+o,a=t.slice(n.byteLength,s),c=e.byteLength-s,l=t.slice(s,c),d=JSON.parse(String.fromCharCode.apply(null,new Uint16Array(a)));return new i.TextMessage(d.T,d.D,d.C,l)}joinBuffers(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Utils=class{static stingToBuffer(e){let t=e.length;var n=new Array(t);for(let r=0;r<t;r++)n[r]=255&e.charCodeAt(r);return new Uint8Array(n)}static arrayToLong(e){var t=0;for(let n=e.byteLength-1;n>=0;n--)t=256*t+e[n];return t}static longToArray(e){var t=new Uint8Array(8);let n=t.length;for(let r=0;r<n;r++){let n=255&e;t[r]=n,e=(e-n)/256}return t}static newGuid(){const e=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Listener=class{constructor(e,t){this.fn=t,this.topic=e,this.count=0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BandwidthConstraints=class{constructor(e,t){this.videobandwidth=e,this.audiobandwidth=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(3);t.DataChannel=class{constructor(e,t){this.listeners=t||new Array,this.PeerChannels=new Array,this.Name=e}findListener(e){return this.listeners.find(t=>t.topic===e)}On(e,t){var n=new i.Listener(e,t);return this.listeners.push(n),n}Off(e){let t=this.listeners.indexOf(this.findListener(e));t>=0&&this.listeners.splice(t,1)}OnOpen(e,t){}OnClose(e,t){}onMessage(e){var t=JSON.parse(e.data),n=this.findListener(t.T);n&&n.fn.apply(this,[JSON.parse(t.D)])}Close(){this.PeerChannels.forEach(e=>{e.dataChannel.close()})}Invoke(e,t,n){return this.PeerChannels.forEach(n=>{"open"===n.dataChannel.readyState&&n.dataChannel.send(new r.TextMessage(e,t,this.Name).toString())}),this}addPeerChannel(e){this.PeerChannels.push(e)}removePeerChannel(e){let t=this.PeerChannels.find(t=>t.peerId===e),n=this.PeerChannels.indexOf(t);n>-1&&this.PeerChannels.splice(n,1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(3);t.Controller=class{constructor(e,t){this.alias=e,this.ws=t,this.listeners=new Array,this.IsConnected=!1,this.On("___error",e=>{this.OnError(e)})}OnError(e){}OnOpen(e){}OnClose(e){}Connect(){return this.ws.send(new r.TextMessage("___connect",{},this.alias).toString()),this}Close(){return this.ws.send(new r.TextMessage("___close",{},this.alias).toString()),this}Subscribe(e,t){return this.ws.send(new r.TextMessage("___subscribe",{topic:e,controller:this.alias},this.alias).toString()),this.On(e,t)}Unsubscribe(e){this.ws.send(new r.TextMessage("___unsubscribe",{topic:e,controller:this.alias},this.alias).toString())}On(e,t){var n=new i.Listener(e,t);return this.listeners.push(n),n}Off(e){let t=this.listeners.indexOf(this.findListener(e));t>=0&&this.listeners.splice(t,1)}findListener(e){return this.listeners.find(t=>t.topic===e)}InvokeBinary(e){if(e instanceof ArrayBuffer)return this.ws.send(e),this;throw"parameter provided must be an ArrayBuffer constructed by Client.BinaryMessage"}PublishBinary(e){if(e instanceof ArrayBuffer)return this.ws.send(e),this;throw"parameter provided must be an ArrayBuffer constructed by Client.BinaryMessage"}Invoke(e,t,n){return this.ws.send(new r.TextMessage(e,t,n||this.alias).toString()),this}Publish(e,t,n){return this.Invoke(e,t,n||this.alias),this}SetProperty(e,t,n){return this.Invoke(e,t,n||this.alias),this}Dispatch(e,t,n){if("___open"===e)return this.IsConnected=!0,void this.OnOpen(JSON.parse(t));if("___close"===e)this.OnClose([JSON.parse(t)]),this.IsConnected=!1;else{let r=this.findListener(e);r&&r.fn(JSON.parse(t),n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PeerChannel=class{constructor(e,t,n){this.peerId=e,this.dataChannel=t,this.label=n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static getCandidate(e){return this.candidates.find(t=>t.label===e)}static tryCandidate(e,t,n){let r={audio:!1,video:{deviceId:e?{exact:e}:void 0,width:{exact:t.width},height:{exact:t.height}}};navigator.mediaDevices.getUserMedia(r).then(e=>{n(t)}).catch(e=>{console.log("non working candidate",t)})}static testResolutions(e,t){let n=0;this.candidates.forEach(r=>{window.setTimeout(()=>{this.tryCandidate(e,this.candidates[n],t),n++},200)})}}t.DetectResolutions=r,r.candidates=[{label:"4K(UHD)",width:3840,height:2160,ratio:"16:9"},{label:"1080p(FHD)",width:1920,height:1080,ratio:"16:9"},{label:"UXGA",width:1600,height:1200,ratio:"4:3"},{label:"720p(HD)",width:1280,height:720,ratio:"16:9"},{label:"SVGA",width:800,height:600,ratio:"4:3"},{label:"VGA",width:640,height:480,ratio:"4:3"},{label:"360p(nHD)",width:640,height:360,ratio:"16:9"},{label:"CIF",width:352,height:288,ratio:"4:3"},{label:"QVGA",width:320,height:240,ratio:"4:3"},{label:"QCIF",width:176,height:144,ratio:"4:3"},{label:"QQVGA",width:160,height:120,ratio:"4:3"}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MediaStreamRecorder=class{constructor(e){this.tracks=e,this.mediaStream=new MediaStream(e),this.recorder=new MediaRecorder(this.mediaStream,{mimeType:"video/webm;codecs=vp9"}),this.recorder.ondataavailable=e=>{e.data.size>0&&this.data.push(e.data)}}getBlobUrl(){let e=new Blob(this.data,{type:"video/webm"});return URL.createObjectURL(e)}getBlob(){return new Blob(this.data,{type:"video/webm"})}flush(){return new Promise((e,t)=>{e(this.getBlobUrl()),this.data=new Array})}stop(){this.recorder.stop()}start(e){this.data=new Array,this.recorder.start(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StreamSource=class{constructor(e,t,n){this.stream=e,this.source=t,this.isLocal=n}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(12),o=r(n(17)),s=n(18),a=n(19),c=n(20),l=n(22),d=n(24),u=n(8);class h{constructor(){this.rtcConfig={sdpSemantics:"plan-b",iceTransports:"all",rtcpMuxPolicy:"require",bundlePolicy:"max-bundle",iceServers:[{urls:"stun:stun.l.google.com:19302"}]},this.appDomain=new l.AppDomain,this.mediaStreamBlender=new d.MediaStreamBlender;let e=document.querySelector("#watermark");this.mediaStreamBlender.onFrameRendered=t=>{t.save(),t.filter="invert()",t.drawImage(e,10,10,100,100),t.restore()},this.mediaStreamBlender.onTrack=()=>{this.audioNode.srcObject=this.mediaStreamBlender.getRemoteAudioStream()},this.mediaStreamBlender.onRecordingStart=()=>{this.sendMessage(this.userSettings.nickname,"I'm now recording the session.")},this.mediaStreamBlender.onRecordingEnded=e=>{let t=document.createElement("p");const n=document.createElement("a");n.setAttribute("href",e),n.textContent="Your recording has ended, here is the file. ( click to download )",n.setAttribute("download",`${Math.random().toString(36).substring(6)}.webm`),t.append(n),document.querySelector("#recorder-download").append(t),$("#recorder-result").modal("show")},document.querySelector("#appDomain").textContent=this.appDomain.domain,document.querySelector("#appVersion").textContent=this.appDomain.version,this.userSettings=new c.UserSettings,void 0!==window.orientation&&document.querySelector(".only-desktop").classList.add("hide"),location.href.includes("https://")||(this.peerId=null),this.numOfChatMessagesUnread=0,this.participants=new Map,this.Slug=location.hash.replace("#",""),this.fullScreenVideo=document.querySelector(".full"),this.shareContainer=document.querySelector("#share-container"),this.shareFile=document.querySelector("#share-file"),this.videoGrid=document.querySelector("#video-grid"),this.audioNode=document.querySelector("#remtote-audio-nodes audio");let t=document.querySelector("#slug"),n=document.querySelector("#joinconference"),r=document.querySelector(".chat"),s=document.querySelector("#chat-message"),u=document.querySelector("#chat-nick"),h=document.querySelector("#chatmessages"),f=document.querySelector("#mute-local-audio"),m=document.querySelector("#mute-local-video"),p=document.querySelector("#share-screen"),g=document.querySelector("#settings"),v=document.querySelector("#save-settings"),y=document.querySelector("#unread-messages"),S=document.querySelector("#generate-slug"),b=document.querySelector("#txt-nick"),C=document.querySelector("#sel-video"),w=document.querySelector("#sel-audio"),k=document.querySelector("#sel-video-res");document.querySelector("#sel-video-res option").textContent="Using dynamic resolution";let O=document.querySelector(".record"),x=document.querySelector("#test-resolutions");b.value=this.userSettings.nickname,O.addEventListener("click",()=>{O.classList.toggle("flash"),this.mediaStreamBlender.render(60),this.mediaStreamBlender.record()}),x.addEventListener("click",()=>{this.testCameraResolutions()}),this.getMediaDevices().then(e=>{e.filter(e=>e.kind.indexOf("input")>0).forEach((e,t)=>{let n=document.createElement("option");n.textContent=e.label||`Device #${t} (name unknown)`,n.value=e.deviceId,"videoinput"==e.kind?(n.value==this.userSettings.videoDevice&&(n.selected=!0),document.querySelector("#sel-video").append(n)):(n.value==this.userSettings.audioDevice&&(n.selected=!0),document.querySelector("#sel-audio").append(n))}),e.filter(e=>e.kind.indexOf("output")>0).forEach(e=>{let t=document.createElement("option");t.textContent=e.label||e.kind,t.setAttribute("value",e.deviceId),document.querySelector("#sel-audio-out").append(t)}),C.value=this.userSettings.videoDevice,w.value=this.userSettings.audioDevice}).catch(console.error),v.addEventListener("click",()=>{this.userSettings.nickname=b.value,this.userSettings.audioDevice=w.value,this.userSettings.videoDevice=C.value,this.userSettings.videoResolution=k.value,this.userSettings.saveSetting();let e=this.userSettings.createConstraints(this.userSettings.videoResolution);this.localMediaStream.getVideoTracks().forEach(t=>{t.applyConstraints(e.video).then(()=>{}).catch(()=>{console.log("error")})})}),g.addEventListener("click",()=>{$("#settings-modal").modal("toggle")}),$(".modal").on("shown.bs.modal",(function(){$(".popover").popover("hide")})),$("#share-file").popover({trigger:"manual",sanitize:!1,placement:"top",title:"Select the file to share.",html:!0,content:$("#share-form").html()}).on("inserted.bs.popover",e=>{$(".file-selected").on("change",e=>{const t=e.target.files[0];a.ReadFile.read(t).then(e=>{this.sendFile({name:e.tf.name,size:e.tf.size,mimeType:e.tf.type},e.buffer),$("#share-file").popover("hide")})})}),this.userSettings.slugHistory.getHistory().forEach(e=>{const t=document.createElement("option");t.setAttribute("value",e),document.querySelector("#slug-history").prepend(t)}),S.addEventListener("click",()=>{t.value=Math.random().toString(36).substring(2).toLocaleLowerCase(),n.disabled=!1,$("#random-slug").popover("hide")}),f.addEventListener("click",e=>{this.muteAudio(e)}),m.addEventListener("click",e=>{this.muteVideo(e)}),p.addEventListener("click",()=>{this.shareScreen()}),this.shareFile.addEventListener("click",()=>{$("#share-file").popover("toggle")});new o.default("#share-link",{text:e=>(e.textContent="Done!",location.origin+"/#"+t.value)});this.Slug.length>=6&&(t.value=this.Slug,n.disabled=!1,document.querySelector("#random-slug").classList.add("d-none")),document.querySelector("#close-chat").addEventListener("click",()=>{r.classList.toggle("d-none"),y.classList.add("d-none"),this.numOfChatMessagesUnread=0,y.textContent="0"}),document.querySelector("#show-chat").addEventListener("click",()=>{r.classList.toggle("d-none"),y.classList.add("d-none"),this.numOfChatMessagesUnread=0,y.textContent="0"}),t.addEventListener("click",()=>{$("#slug").popover("show"),$("#random-slug").popover("hide")}),0==location.hash.length?$("#random-slug").popover("show"):n.textContent="JOIN",t.addEventListener("keyup",()=>{t.value.length>=6?n.disabled=!1:n.disabled=!0}),u.value=this.userSettings.nickname,u.addEventListener("click",()=>{u.value=""}),n.addEventListener("click",()=>{this.videoGrid.classList.add("d-flex"),document.querySelector("#record").classList.remove("d-none"),$("#random-slug").popover("hide"),document.querySelector("#share-file").classList.toggle("hide"),document.querySelector("#share-screen").classList.toggle("d-none"),document.querySelector("#show-chat").classList.toggle("d-none"),document.querySelector(".our-brand").remove(),$("#slug").popover("hide"),n.classList.add("hide"),document.querySelector(".remote").classList.remove("hide"),document.querySelector(".overlay").classList.add("d-none"),document.querySelector(".join").classList.add("d-none"),this.userSettings.slugHistory.addToHistory(t.value),this.userSettings.saveSetting(),this.rtcClient.ChangeContext(this.appDomain.getSlug(t.value))}),this.factory=this.connectToServer(this.appDomain.serverUrl,{}),this.factory.OnClose=e=>{console.error(e)},this.factory.OnOpen=e=>{this.rtcClient=new i.WebRTC(e,this.rtcConfig),e.On("fileShare",(e,t)=>{this.fileReceived(e,t)}),e.On("instantMessage",e=>{this.numOfChatMessagesUnread++;let t=document.createElement("p");t.textContent=e.text;let n=document.createElement("mark");n.textContent=e.from,t.prepend(n),h.prepend(t),r.classList.contains("d-none")&&(y.classList.remove("d-none"),y.textContent=this.numOfChatMessagesUnread.toString())}),s.addEventListener("keyup",e=>{13==e.keyCode&&(this.sendMessage(u.value,s.value),s.value="")}),this.rtcClient.OnLocalStream=e=>{},this.rtcClient.OnContextConnected=e=>{},this.rtcClient.OnContextCreated=e=>{},this.rtcClient.OnContextChanged=e=>{this.rtcClient.ConnectContext()},this.rtcClient.OnContextDisconnected=e=>{document.querySelector(".p"+e.id).remove()},this.rtcClient.OnContextConnected=e=>{document.querySelector(".remote").classList.remove("hide")},this.rtcClient.OnRemoteTrack=(e,t)=>{let n=this.tryAddParticipant(t.id);n.addTrack(e,n=>{this.mediaStreamBlender.addTracks(`audio-${t.id}`,[e],!1)}),n.onVideoTrackLost=(e,t,n)=>{let r=document.querySelector(".p"+e);r&&r.remove()}},this.rtcClient.OnContextCreated=function(e){},e.OnOpen=e=>{this.getLocalStream(c.UserSettings.defaultConstraints,e=>{this.localMediaStream=e,this.rtcClient.AddLocalStream(e),this.addLocalVideo(e)})},e.Connect()}}testCameraResolutions(){let e=document.querySelector("#sel-video-res");e.innerHTML="";let t=document.querySelector("#sel-video").value;u.DetectResolutions.testResolutions(""==t?void 0:t,t=>{let n=document.createElement("option");n.textContent=`${t.label} ${t.width} x ${t.height} ${t.ratio}`,n.value=t.label,e.append(n)}),e.removeAttribute("disabled")}getLocalStream(e,t){navigator.mediaDevices.getUserMedia(e).then(e=>{t(e)}).catch(e=>{console.error(e)})}fileReceived(e,t){const n=document.createElement("p");n.textContent="Hey,here is shared file, click to download.. ";const r=new Blob([t],{type:e.mimeType}),i=window.URL.createObjectURL(r),o=document.createElement("a");o.setAttribute("href",i),o.textContent=e.name,o.setAttribute("download",e.name),n.append(o),document.querySelector("#chatmessages").prepend(n)}sendFile(e,t){var n=new i.Message("fileShare",e,"broker",t);let r=new i.BinaryMessage(n.toString(),t);this.factory.GetController("broker").InvokeBinary(r.Buffer)}shareScreen(){navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}).then(e=>{e.getVideoTracks().forEach(e=>{this.rtcClient.LocalStreams[0].addTrack(e)}),this.addLocalVideo(e),document.querySelector("#share-screen").classList.add("hide")}).catch(e=>console.error)}muteVideo(e){let t=e.target;t.classList.toggle("fa-video"),t.classList.toggle("fa-video-slash"),this.localMediaStream.getVideoTracks().forEach(e=>{e.enabled=!e.enabled})}muteAudio(e){let t=e.target;t.classList.toggle("fa-microphone"),t.classList.toggle("fa-microphone-slash"),this.localMediaStream.getAudioTracks().forEach(e=>{e.enabled=!e.enabled})}recordStream(e){}addLocalVideo(e){let t=document.createElement("video");t.autoplay=!0,t.muted=!0,t.classList.add("l-"+e.id),t.srcObject=e,document.querySelector(".local").append(t),this.mediaStreamBlender.addTracks(e.id,e.getTracks(),!0)}sendMessage(e,t){0==e.length&&(e="NoName");const n={text:t,from:e};this.factory.GetController("broker").Invoke("instantMessage",n)}connectToServer(e,t){return new i.Factory(e,["broker"])}addRemoteVideo(e,t){this.shareContainer.classList.contains("hide")||this.shareContainer.classList.add("hide");let n=document.createElement("div");n.classList.add("video-tools");let r=document.createElement("li");r.setAttribute("class","p"+e);let i=document.createElement("i");i.classList.add("fas","fa-arrows-alt","fa-2x","fullscreen"),n.append(i),r.prepend(n);let o=document.createElement("video");o.srcObject=t,o.width=1920,o.height=1080,o.autoplay=!0,r.append(o),i.addEventListener("click",e=>{let t=o;document.fullscreenElement?document.exitFullscreen():t.requestFullscreen().catch(e=>{alert(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}),document.querySelector("#remote-videos").append(r)}getMediaDevices(){return new Promise((e,t)=>{navigator.mediaDevices.enumerateDevices().then(t=>{e(t)}).catch(t)})}tryAddParticipant(e){if(this.participants.has(e))return this.participants.get(e);{this.participants.set(e,new s.AppParticipant(e));let t=this.participants.get(e);return t.onVideoTrackAdded=(e,t,n)=>{this.mediaStreamBlender.addTracks(e,[n],!1),this.addRemoteVideo(e,t)},t}}static getInstance(){return new h}}t.App=h,document.addEventListener("DOMContentLoaded",()=>{location.href.includes("https://")||location.href.includes("http://localhost")||(location.href=location.href.replace("http://","https://"));let e=h.getInstance();window.app=e})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4);t.BandwidthConstraints=r.BandwidthConstraints;var i=n(1);t.BinaryMessage=i.BinaryMessage;var o=n(5);t.DataChannel=o.DataChannel;var s=n(13);t.Factory=s.Factory;var a=n(0);t.Message=a.TextMessage;var c=n(3);t.Listener=c.Listener;var l=n(7);t.PeerChannel=l.PeerChannel;var d=n(14);t.PropertyMessage=d.PropertyMessage;var u=n(6);t.Proxy=u.Controller;var h=n(2);t.Utils=h.Utils;var f=n(15);t.WebRTC=f.WebRTC},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(6);t.Factory=class{constructor(e,t,n){this.url=e,this.controllers=new Map,this.ws=new WebSocket(e+this.toQuery(n||{})),this.ws.binaryType="arraybuffer",t.forEach(e=>{this.controllers.set(e,new i.Controller(e,this.ws))}),this.ws.onmessage=e=>{if("object"!=typeof e.data){let t=JSON.parse(e.data);this.GetController(t.C).Dispatch(t.T,t.D)}else{let t=r.BinaryMessage.fromArrayBuffer(e.data);this.GetController(t.C).Dispatch(t.T,t.D,t.B)}},this.ws.onclose=e=>{this.IsConnected=!1,this.OnClose.apply(this,[e])},this.ws.onerror=e=>{this.OnError.apply(this,[e])},this.ws.onopen=e=>{this.IsConnected=!0,this.OnOpen.apply(this,Array.from(this.controllers.values()))}}toQuery(e){return`?${Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}`}Close(){this.ws.close()}GetController(e){return this.controllers.get(e)}RemoveController(e){this.controllers.delete(e)}OnOpen(e){}OnError(e){}OnClose(e){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);t.PropertyMessage=class{constructor(){this.messageId=r.Utils.newGuid()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(16),i=n(7),o=n(5),s=n(4);t.WebRTC=class{constructor(e,t){this.brokerController=e,this.rtcConfig=t,this.Errors=new Array,this.LocalStreams=new Array,this.DataChannels=new Map,this.Peers=new Map,this.brokerController.On("contextSignal",e=>{switch(JSON.parse(e.message).type){case"offer":this.onOffer(e);break;case"answer":this.onAnswer(e);break;case"candidate":this.onCandidate(e)}}),e.On("contextCreated",e=>{this.LocalPeerId=e.peerId,this.Context=e.context,this.OnContextCreated(e)}),e.On("contextChanged",e=>{this.Context=e,this.OnContextChanged(e)}),e.On("connectTo",e=>{this.onConnectTo(e)})}onConnectTo(e){this.Connect(e)}onConnected(e){this.OnContextConnected(this.findPeerConnection(e),this.getPeerConnection(e))}OnDisconnected(e){let t=this.getPeerConnection(e);this.OnContextDisconnected(this.findPeerConnection(e),t),t.close(),this.removePeerConnection(e)}setBandwithConstraints(e,t){this.bandwidthConstraints=new s.BandwidthConstraints(e,t)}setMediaBitrates(e){return this.setMediaBitrate(this.setMediaBitrate(e,"video",this.bandwidthConstraints.videobandwidth),"audio",this.bandwidthConstraints.audiobandwidth)}setMediaBitrate(e,t,n){let r=e.split("\n"),i=-1;for(let e=0;e<r.length;e++)if(0===r[e].indexOf("m="+t)){i=e;break}if(-1===i)return e;for(i++;0===r[i].indexOf("i=")||0===r[i].indexOf("c=");)i++;if(0===r[i].indexOf("b"))return r[i]="b=AS:"+n,r.join("\n");var o=r.slice(0,i);return o.push("b=AS:"+n),(o=o.concat(r.slice(i,r.length))).join("\n")}CreateDataChannel(e){let t=new o.DataChannel(e);return this.DataChannels.set(e,t),t}RemoveDataChannel(e){this.DataChannels.delete(e)}addError(e){this.OnError(e)}onCandidate(e){let t=JSON.parse(e.message).iceCandidate;this.getPeerConnection(e.sender).addIceCandidate(new RTCIceCandidate(t)).then(()=>{}).catch(e=>{this.addError(e)})}onAnswer(e){this.getPeerConnection(e.sender).setRemoteDescription(new RTCSessionDescription(JSON.parse(e.message))).then(e=>{}).catch(e=>{this.addError(e)})}onOffer(e){let t=this.getPeerConnection(e.sender);this.LocalStreams.forEach(e=>{e.getTracks().forEach((function(n){t.addTrack(n,e)}))}),t.setRemoteDescription(new RTCSessionDescription(JSON.parse(e.message))),t.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{t.setLocalDescription(n).then(()=>{this.bandwidthConstraints&&(n.sdp=this.setMediaBitrates(n.sdp));let t={sender:this.LocalPeerId,recipient:e.sender,message:JSON.stringify(n)};this.brokerController.Invoke("contextSignal",t)}).catch(e=>this.addError(e))}).catch(e=>this.addError(e))}AddLocalStream(e){return this.LocalStreams.push(e),this}AddIceServer(e){return this.rtcConfig.iceServers.push(e),this}removePeerConnection(e){this.Peers.delete(e)}createPeerConnection(e){let t=new RTCPeerConnection(this.rtcConfig);return t.onsignalingstatechange=e=>{},t.onicecandidate=t=>{if(t&&t.candidate&&t.candidate){let n={sender:this.LocalPeerId,recipient:e,message:JSON.stringify({type:"candidate",iceCandidate:t.candidate})};this.brokerController.Invoke("contextSignal",n)}},t.oniceconnectionstatechange=t=>{switch(t.target.iceConnectionState){case"connected":this.onConnected(e);break;case"disconnected":this.OnDisconnected(e)}},t.ontrack=t=>{let n=this.Peers.get(e);n.stream.addTrack(t.track),this.OnRemoteTrack(t.track,n)},this.DataChannels.forEach(n=>{let r=new i.PeerChannel(e,t.createDataChannel(n.Name),n.Name);n.addPeerChannel(r),t.ondatachannel=t=>{let r=t.channel;r.onopen=t=>{n.OnOpen(t,e)},r.onclose=t=>{n.removePeerChannel(e),n.OnClose(t,e)},r.onmessage=e=>{n.onMessage(e)}}}),t}findPeerConnection(e){return this.Peers.get(e)}reconnectAll(){throw"not yet implemeted"}getPeerConnection(e){let t=this.Peers.get(e);if(!t){let t=new r.WebRTCConnection(e,this.createPeerConnection(e));return this.Peers.set(e,t),t.RTCPeer}return t.RTCPeer}createOffer(e){let t=this.createPeerConnection(e.peerId);return this.LocalStreams.forEach(e=>{e.getTracks().forEach(n=>{t.addTrack(n,e)}),this.OnLocalStream(e)}),t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(n=>{t.setLocalDescription(n).then(()=>{this.bandwidthConstraints&&(n.sdp=this.setMediaBitrates(n.sdp));let t={sender:this.LocalPeerId,recipient:e.peerId,message:JSON.stringify(n)};this.brokerController.Invoke("contextSignal",t)}).catch(e=>{this.addError(e)})}).catch(e=>{this.addError(e)}),t}Disconnect(){this.Peers.forEach(e=>{e.RTCPeer.close()}),this.ChangeContext(Math.random().toString(36).substring(2))}DisconnectPeer(e){this.findPeerConnection(e).RTCPeer.close()}Connect(e){return e.forEach(e=>{let t=new r.WebRTCConnection(e.peerId,this.createOffer(e));this.Peers.set(e.peerId,t)}),this}ChangeContext(e){return this.brokerController.Invoke("changeContext",{context:e}),this}ConnectPeers(){this.brokerController.Invoke("connectContext",{})}ConnectContext(){this.ConnectPeers()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.WebRTCConnection=class{constructor(e,t){this.id=e,this.RTCPeer=t,this.stream=new MediaStream}}},function(e,t,n){
/*!
 * clipboard.js v2.0.6
 * https://clipboardjs.com/
 * 
 * Licensed MIT Â© Zeno Rocha
 */
var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=function(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var r=window.getSelection(),i=document.createRange();i.selectNodeContents(e),r.removeAllRanges(),r.addRange(i),t=r.toString()}return t}},function(e,t){function n(){}n.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function i(){r.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],i=[];if(r&&t)for(var o=0,s=r.length;o<s;o++)r[o].fn!==t&&r[o].fn._!==t&&i.push(r[o]);return i.length?n[e]=i:delete n[e],this}},e.exports=n,e.exports.TinyEmitter=n},function(e,t,n){var r=n(3),i=n(4);e.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!r.string(t))throw new TypeError("Second argument must be a String");if(!r.fn(n))throw new TypeError("Third argument must be a Function");if(r.node(e))return function(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}(e,t,n);if(r.nodeList(e))return function(e,t,n){return Array.prototype.forEach.call(e,(function(e){e.addEventListener(t,n)})),{destroy:function(){Array.prototype.forEach.call(e,(function(e){e.removeEventListener(t,n)}))}}}(e,t,n);if(r.string(e))return function(e,t,n){return i(document.body,e,t,n)}(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"==typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},function(e,t,n){var r=n(5);function i(e,t,n,r,i){var s=o.apply(this,arguments);return e.addEventListener(n,s,i),{destroy:function(){e.removeEventListener(n,s,i)}}}function o(e,t,n,i){return function(n){n.delegateTarget=r(n.target,t),n.delegateTarget&&i.call(e,n)}}e.exports=function(e,t,n,r,o){return"function"==typeof e.addEventListener?i.apply(null,arguments):"function"==typeof n?i.bind(null,document).apply(null,arguments):("string"==typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return i(e,t,n,r,o)})))}},function(e,t){if("undefined"!=typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}e.exports=function(e,t){for(;e&&9!==e.nodeType;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolveOptions(t),this.initSelection()}return s(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=i()(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=i()(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),document.activeElement.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":o(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}(),c=n(1),l=n.n(c),d=n(2),u=n.n(d),h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.resolveOptions(n),r.listenClick(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),f(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText,this.container="object"===h(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=u()(e,"click",(function(e){return t.onClick(e)}))}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new a({action:this.action(t),target:this.target(t),text:this.text(t),container:this.container,trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return p("action",e)}},{key:"defaultTarget",value:function(e){var t=p("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return p("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"==typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach((function(e){n=n&&!!document.queryCommandSupported(e)})),n}}]),t}(l.a);function p(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}t.default=m}]).default},e.exports=r()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AppParticipant=class{constructor(e){this.id=e,this.videoTracks=new Array,this.audioTracks=new Array}addVideoTrack(e){this.videoTracks.push(e);let t=new MediaStream([e]);e.onended=()=>{this.onVideoTrackLost(this.id,t,e)},this.onVideoTrackAdded(this.id,t,e)}addAudioTrack(e){this.audioTracks.push(e);let t=new Audio;return t.classList.add(".p"+this.id),t.autoplay=!0,t.srcObject=new MediaStream([e]),t}addTrack(e,t){if("video"==e.kind)this.addVideoTrack(e);else{let n=this.addAudioTrack(e);t&&t(n)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ReadFile=class{static read(e){return new Promise((t,n)=>{let r=new FileReader;var i;r.onerror=n,r.onload=(i=e,function(e){t({buffer:e.target.result,tf:i})}),r.readAsArrayBuffer(e)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(21),i=n(8);class o{constructor(){this.slugHistory=new r.SlugHistory;const e=localStorage.getItem("settings");if(e){let t=JSON.parse(e);this.audioDevice=t.audioDevice,this.videoDevice=t.videoDevice,this.videoResolution=t.videoResolution,this.nickname=t.nickname,this.slugHistory.history=t.slugHistory}else this.slugHistory.history=new Array,this.nickname=Math.random().toString(36).substring(8),this.audioDevice="",this.videoDevice="",this.videoResolution=""}saveSetting(){const e={slugHistory:this.slugHistory.history,videoDevice:this.videoDevice,audioDevice:this.audioDevice,videoResolution:this.videoResolution,nickname:this.nickname};localStorage.setItem("settings",JSON.stringify(e))}createConstraints(e){let t;if(0===e.length)t={video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080}},audio:!0};else{const n=i.DetectResolutions.getCandidate(e);t={audio:!0,video:{width:{exact:n.width},height:{exact:n.height}}}}return this.audioDevice.length>0&&(t.video.deviceId=this.audioDevice),this.videoDevice.length>0&&(t.video.deviceId=this.videoDevice),console.log(t),t}}t.UserSettings=o,o.defaultConstraints={video:{width:{min:640,ideal:1920},height:{min:400,ideal:1080}},audio:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SlugHistory=class{constructor(){}getHistory(){return this.history}addToHistory(e){this.history.includes(e)||this.history.push(e)}clearHistory(){this.history=new Array}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(23);t.AppDomain=class{constructor(){this.domain=r.domain,this.contextPrefix=r.contextPrefix,this.serverUrl=r.serverUrl||"wss://"+window.location.hostname,this.version=r.version}getSlug(e){return`${this.contextPrefix}-${e}`}}},function(e){e.exports=JSON.parse('{"domain":"Kollokvium","contextPrefix":"kollokvium","serverUrl":"","version":"1.1.2"}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9);t.MediaStreamRecorder=r.MediaStreamRecorder;var i=n(25);t.MediaStreamBlender=i.MediaStreamBlender;var o=n(26);t.MediaLoader=o.MediaLoader;var s=n(10);t.StreamSource=s.StreamSource},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9),i=n(10);t.MediaStreamBlender=class{constructor(e){this.videosSources=new Map,this.audioSources=new Map,this.surface=e||document.createElement("canvas"),this.ctx=this.surface.getContext("2d")}createVideoFromStream(e){const t=document.createElement("video");return t.srcObject=e,t.muted=!0,t.width=640,t.height=360,t.autoplay=!0,t.play(),t}captureStream(){let e=this.surface.captureStream()||this.surface.mozCaptureStream(),t=new MediaStream;return e.getTracks().filter((function(e){return"video"===e.kind})).forEach(e=>{t.addTrack(e)}),t}addTracks(e,t,n){const r=new MediaStream;return t.forEach(t=>{if("video"===t.kind){r.addTrack(t);let o=new i.StreamSource(r,this.createVideoFromStream(r),n);this.videosSources.set(e,o)}else{this.audioContext||(this.audioContext=new AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination()),r.addTrack(t);let o=this.audioContext.createMediaStreamSource(r),s=new i.StreamSource(r,o,n);n||o.connect(this.audioDestination),this.audioSources.set(e,s)}t.onended=()=>{this.onTrackEnded(e,t)}}),this.onTrack(),r}refreshCanvas(){const e=this.videosSources.size;let t=Array.from(this.videosSources.values());this.surface.width=e>1?2*t[0].source.width:t[0].source.width;let n=1;3!==e&&4!==e||(n=2),5!==e&&6!==e||(n=3),7!==e&&8!==e||(n=4),9!==e&&10!==e||(n=5),this.surface.height=t[0].source.height*n}getRemoteAudioStream(){return this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioSources.forEach(e=>{e.isLocal||e.source.connect(this.audioDestination)}),this.audioDestination.stream}getAllAudioStreams(){return this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioSources.forEach(e=>{e.source.connect(this.audioDestination)}),this.audioDestination.stream}drawVideo(e,t){let n=0,r=0,i=e.width,o=e.height;1===t&&(n=e.width),2===t&&(r=e.height),3===t&&(n=e.width,r=e.height),4===t&&(r=2*e.height),5===t&&(n=e.width,r=2*e.height),6===t&&(r=3*e.height),7===t&&(n=e.width,r=3*e.height),this.ctx.drawImage(e,n,r,i,o)}record(){if(this.isRecording)this.recorder.stop(),this.recorder.flush().then(this.onRecordingEnded);else{let e=this.captureStream().getVideoTracks(),t=this.getAllAudioStreams().getAudioTracks(),n=[e[0],t[0]];this.recorder=new r.MediaStreamRecorder(n),this.recorder.start(10),this.onRecordingStart()}this.isRecording=!this.isRecording}render(e){this.isRendering?(clearInterval(this._handle),this._handle=-1):(this.refreshCanvas(),this._handle=setInterval(()=>{Array.from(this.videosSources.values()).forEach((e,t)=>{this.drawVideo(e.source,t)}),this.onFrameRendered&&this.onFrameRendered(this.ctx)},1e3/e)),this.isRendering=!this.isRendering}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MediaLoader=class{static readFile(e){return new Promise((t,n)=>{fetch(e).then(e=>{t(e.blob())}).catch(n)})}static getAudioMediaStream(e,t){this.readFile(e).then(e=>{var n=new AudioContext,r=n.createGain();r.connect(n.destination),r.gain.value=0;let i=new FileReader;i.onload=function(e){n.decodeAudioData(e.target.result,o)},i.readAsArrayBuffer(e);const o=e=>{let i=n.createBufferSource();i.buffer=e,i.start(0,0),i.connect(r);let o=n.createMediaStreamDestination();i.connect(o),t(o.stream)}})}}}]);